{% extends "base.html" %}
{% block content %}
  <h2 class="section-title">대시보드</h2>
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <div class="card-dashboard">
      <div class="card-label">USD → KRW</div>
      <div id="rate" class="card-rate">--</div>
      <div id="rate_asof" class="card-subtext"></div>
    </div>
    <!-- 총 자산 -->
    <div class="card-dashboard">
      <div class="card-label">총 자산</div>
      <div class="card-value" id="total_both">--</div>
    </div>
    <!-- 자산 in USD -->
    <div class="card-dashboard">
      <div class="card-label">자산 in USD</div>
      <div class="card-value" id="total_usd">--</div>
      <div class="card-subtext" id="usd_percent"></div>
    </div>
    <!-- 자산 in KRW -->
    <div class="card-dashboard">
      <div class="card-label">자산 in KRW</div>
      <div class="card-value" id="total_krw">--</div>
      <div class="card-subtext" id="krw_percent"></div>
    </div>
  </div>
  <div class="bg-white shadow rounded p-4 mb-6">
    <div class="text-sm font-medium mb-2">USD 계좌</div>
    <div class="overflow-x-auto">
      <table class="table-auto w-full text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="p-2 text-left">은행</th>
            <th class="p-2 text-left">계좌명</th>
            <th class="p-2 text-right border-r-2">잔액(USD)</th>
            <th class="p-2 text-right bg-blue-50">현금</th>
            <th class="p-2 text-right bg-blue-50">적금</th>
            <th class="p-2 text-right bg-blue-50">채권</th>
            <th class="p-2 text-right bg-blue-50 border-r-2 border-gray-300">주식</th>
            <th class="p-2 text-right border-r-2">환산(KRW)</th>
            <th class="p-2 text-right bg-yellow-50">투자금액(USD)</th>
            <th class="p-2 text-right bg-yellow-50">수익금액(USD)</th>
            <th class="p-2 text-right bg-yellow-50 border-r-2 border-gray-300">수익률(%)</th>
            <th class="p-2 text-right">
              환율 효과(%)
              <br>
              <span class="text-xs text-gray-500">(평균환율)</span>
            </th>
            <th class="p-2 text-right">환율고려 수익금액(KRW)</th>
            <th class="p-2 text-right">환율고려 수익률(%)</th>
          </tr>
        </thead>
        <tbody id="usd_table">
        </tbody>
        <tfoot class="bg-gray-100 font-semibold">
          <tr>
            <td colspan="2" class="p-2 text-right">총계</td>
            <td class="p-2 text-right" id="usd_sum_usd"></td>
            <td class="p-2 text-right" id="usd_sum_cash"></td>
            <td class="p-2 text-right" id="usd_sum_saving"></td>
            <td class="p-2 text-right" id="usd_sum_bond"></td>
            <td class="p-2 text-right" id="usd_sum_stock"></td>
            <td class="p-2 text-right" id="usd_sum_krw"></td>
            <td class="p-2 text-right" id="usd_sum_invested_usd"></td>
            <td class="p-2 text-right" id="usd_sum_return_amt"></td>
            <td class="p-2 text-right" id="usd_sum_return_pct"></td>
            <td class="p-2 text-right" id="usd_sum_fx_effect_pct">-</td>
            <td class="p-2 text-right" id="usd_sum_fx_return_amt">!</td>
            <td class="p-2 text-right" id="usd_sum_fx_return_pct">!</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
  <!-- KRW 계좌 목록 -->
  <div class="bg-white shadow rounded p-4 mb-6">
    <div class="text-sm font-medium mb-2">KRW 계좌</div>
    <div class="overflow-x-auto">
      <table class="table-auto w-full text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="p-2 text-left">은행</th>
            <th class="p-2 text-left">계좌명</th>
            <th class="p-2 text-right border-r-2">잔액(KRW)</th>
            <!-- Breakdown 컬럼 -->
            <th class="p-2 text-right bg-blue-50">현금</th>
            <th class="p-2 text-right bg-blue-50">적금</th>
            <th class="p-2 text-right bg-blue-50">채권</th>
            <th class="p-2 text-right bg-blue-50 border-r-2">주식</th>
            <th class="p-2 text-right border-r-2">환산(USD)</th>
            <!-- 수익 관련 컬럼 -->
            <th class="p-2 text-right bg-yellow-50">투자금액(KRW)</th>
            <th class="p-2 text-right bg-yellow-50">수익금액(KRW)</th>
            <th class="p-2 text-right bg-yellow-50 border-r-2">수익률(%)</th>
          </tr>
        </thead>
        <tbody id="krw_table">
        </tbody>
        <tfoot class="bg-gray-100 font-semibold">
          <tr>
            <td colspan="2" class="p-2 text-right">총계</td>
            <td class="p-2 text-right" id="krw_sum_krw"></td>
            <td class="p-2 text-right" id="krw_sum_cash"></td>
            <td class="p-2 text-right" id="krw_sum_saving"></td>
            <td class="p-2 text-right" id="krw_sum_bond"></td>
            <td class="p-2 text-right" id="krw_sum_stock"></td>
            <td class="p-2 text-right" id="krw_sum_usd"></td>
            <td class="p-2 text-right" id="krw_sum_invested_krw"></td>
            <td class="p-2 text-right" id="krw_sum_return_amt"></td>
            <td class="p-2 text-right" id="krw_sum_return_pct"></td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
  <!-- 보유 종목 상세 -->
  <div class="bg-white shadow rounded p-4 mb-6">
    <div class="text-sm font-medium mb-2">보유 종목 상세 (USD)</div>
    <div class="overflow-x-auto">
      <table class="table-auto w-full text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="p-2 text-left">주식 이름</th>
            <th class="p-2 text-left">종목 코드</th>
            <th class="p-2 text-left">계좌명</th>
            <th class="p-2 text-right">보유수량</th>
            <th class="p-2 text-right">평균매입가 (USD)</th>
            <th class="p-2 text-right">현재가 (USD)</th>
            <th class="p-2 text-right">총 평가금액 (USD)</th>
            <th class="p-2 text-right">총 시세차익 (USD)</th>
            <th class="p-2 text-right">누적 배당금 (USD)</th>
            <th class="p-2 text-right">수익률 (%)</th>
          </tr>
        </thead>
        <tbody id="stock_table_usd">
          <!-- JS에서 동적으로 채움 -->
        </tbody>
      </table>
    </div>
  </div>
  <div class="bg-white shadow rounded p-4 mb-6">
    <div class="text-sm font-medium mb-2">보유 종목 상세 (KRW)</div>
    <div class="overflow-x-auto">
      <table class="table-auto w-full text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="p-2 text-left">주식 이름</th>
            <th class="p-2 text-left">종목 코드</th>
            <th class="p-2 text-left">계좌명</th>
            <th class="p-2 text-right">보유수량</th>
            <th class="p-2 text-right">평균매입가 (KRW)</th>
            <th class="p-2 text-right">현재가 (KRW)</th>
            <th class="p-2 text-right">총 평가금액 (KRW)</th>
            <th class="p-2 text-right">총 시세차익 (KRW)</th>
            <th class="p-2 text-right">누적 배당금 (KRW)</th>
            <th class="p-2 text-right">수익률 (%)</th>
          </tr>
        </thead>
        <tbody id="stock_table_krw">
          <!-- JS에서 동적으로 채움 -->
        </tbody>
      </table>
    </div>
  </div>
  <div class="bg-white shadow rounded p-4 mb-6">
    <div class="text-sm font-medium mb-2">자산 카테고리 구성</div>
    <canvas id="categoryPie" class="max-w-[400px] max-h-[400px]"></canvas>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <script src="{{ url_for('static', path='js/dashboard/dashboard.js') }}"></script>
{% endblock %}
