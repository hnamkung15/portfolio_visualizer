{% extends "base.html" %}
{% block content %}
  <!-- Add a row for the Data Sync button and label -->
  <div class="flex items-center mb-4">
    <button id="dataSyncButton"
            class="bg-blue-500 text-white px-4 py-2 rounded mr-4">{{ _('data_sync') }}</button>
    <span id="lastSyncLabel" class="text-gray-600">{{ _('last_sync') }}</span>
    <div id="loadingIndicator" class="ml-4 hidden">{{ _('loading') }}</div>
    <!-- 로딩 표시 -->
  </div>
  <h2 class="text-lg font-semibold mt-4 mb-3">{{ _('dashboard') }}</h2>
  <!-- KPI cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
    <div class="bg-white shadow rounded p-4">
      <div class="text-lg text-gray-600 mb-1">USD → KRW</div>
      <div id="rate" class="text-4xl font-semibold">--</div>
      <div id="rate_asof" class="text-lg text-gray-600 mt-1"></div>
    </div>
    <!-- 총 자산 -->
    <div class="bg-white shadow rounded p-4">
      <div class="text-lg text-gray-600 mb-1">{{ _('total_assets') }}</div>
      <div class="text-2xl font-semibold" id="total_both">--</div>
    </div>
    <!-- 자산 in USD -->
    <div class="bg-white shadow rounded p-4">
      <div class="text-lg text-gray-600 mb-1">{{ _('assets_usd') }}</div>
      <div class="text-2xl font-semibold" id="total_usd">--</div>
      <div class="text-lg text-gray-600 mt-1" id="usd_percent"></div>
    </div>
    <!-- 자산 in KRW -->
    <div class="bg-white shadow rounded p-4">
      <div class="text-lg text-gray-600 mb-1">{{ _('assets_krw') }}</div>
      <div class="text-2xl font-semibold" id="total_krw">--</div>
      <div class="text-lg text-gray-600 mt-1" id="krw_percent"></div>
    </div>
  </div>
  <div class="bg-white shadow rounded p-4 mb-6">
    <div class="text-sm font-medium mb-2">{{ _('usd_accounts') }}</div>
    <div class="overflow-x-auto">
      <table class="table-auto w-full text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="p-2 text-left">{{ _('bank') }}</th>
            <th class="p-2 text-left">{{ _('account_name') }}</th>
            <th class="p-2 text-right border-r-2">{{ _('balance_usd') }}</th>
            <th class="p-2 text-right bg-blue-50">{{ _('cash') }}</th>
            <th class="p-2 text-right bg-blue-50">{{ _('saving') }}</th>
            <th class="p-2 text-right bg-blue-50">{{ _('bond') }}</th>
            <th class="p-2 text-right bg-blue-50 border-r-2 border-gray-300">{{ _('stock') }}</th>
            <th class="p-2 text-right border-r-2">{{ _('converted_krw') }}</th>
            <th class="p-2 text-right bg-yellow-50">{{ _('invested_amount_usd') }}</th>
            <th class="p-2 text-right bg-yellow-50">{{ _('profit_amount_usd') }}</th>
            <th class="p-2 text-right bg-yellow-50 border-r-2 border-gray-300">{{ _('return_rate') }}</th>
            <th class="p-2 text-right">
              {{ _('fx_effect') }}
              <br>
              <span class="text-xs text-gray-500">{{ _('avg_rate') }}</span>
            </th>
            <th class="p-2 text-right">{{ _('fx_considered_profit_krw') }}</th>
            <th class="p-2 text-right">{{ _('fx_considered_return_rate') }}</th>
          </tr>
        </thead>
        <tbody id="usd_table">
        </tbody>
        <tfoot class="bg-gray-100 font-semibold">
          <tr>
            <td colspan="2" class="p-2 text-right">{{ _('total') }}</td>
            <td class="p-2 text-right" id="usd_sum_usd"></td>
            <td class="p-2 text-right" id="usd_sum_cash"></td>
            <td class="p-2 text-right" id="usd_sum_saving"></td>
            <td class="p-2 text-right" id="usd_sum_bond"></td>
            <td class="p-2 text-right" id="usd_sum_stock"></td>
            <td class="p-2 text-right" id="usd_sum_krw"></td>
            <td class="p-2 text-right" id="usd_sum_invested_usd"></td>
            <td class="p-2 text-right" id="usd_sum_return_amt"></td>
            <td class="p-2 text-right" id="usd_sum_return_pct"></td>
            <td class="p-2 text-right" id="usd_sum_fx_effect_pct">-</td>
            <td class="p-2 text-right" id="usd_sum_fx_return_amt">!</td>
            <td class="p-2 text-right" id="usd_sum_fx_return_pct">!</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
  <!-- KRW 계좌 목록 -->
  <div class="bg-white shadow rounded p-4 mb-6">
    <div class="text-sm font-medium mb-2">{{ _('krw_accounts') }}</div>
    <div class="overflow-x-auto">
      <table class="table-auto w-full text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="p-2 text-left">{{ _('bank') }}</th>
            <th class="p-2 text-left">{{ _('account_name') }}</th>
            <th class="p-2 text-right border-r-2">{{ _('balance_krw') }}</th>
            <!-- Breakdown 컬럼 -->
            <th class="p-2 text-right bg-blue-50">{{ _('cash') }}</th>
            <th class="p-2 text-right bg-blue-50">{{ _('saving') }}</th>
            <th class="p-2 text-right bg-blue-50">{{ _('bond') }}</th>
            <th class="p-2 text-right bg-blue-50 border-r-2">{{ _('stock') }}</th>
            <th class="p-2 text-right border-r-2">{{ _('converted_usd') }}</th>
            <!-- 수익 관련 컬럼 -->
            <th class="p-2 text-right bg-yellow-50">{{ _('invested_amount_krw') }}</th>
            <th class="p-2 text-right bg-yellow-50">{{ _('profit_amount_krw') }}</th>
            <th class="p-2 text-right bg-yellow-50 border-r-2">{{ _('return_rate') }}</th>
          </tr>
        </thead>
        <tbody id="krw_table">
        </tbody>
        <tfoot class="bg-gray-100 font-semibold">
          <tr>
            <td colspan="2" class="p-2 text-right">{{ _('total') }}</td>
            <td class="p-2 text-right" id="krw_sum_krw"></td>
            <td class="p-2 text-right" id="krw_sum_cash"></td>
            <td class="p-2 text-right" id="krw_sum_saving"></td>
            <td class="p-2 text-right" id="krw_sum_bond"></td>
            <td class="p-2 text-right" id="krw_sum_stock"></td>
            <td class="p-2 text-right" id="krw_sum_usd"></td>
            <td class="p-2 text-right" id="krw_sum_invested_krw"></td>
            <td class="p-2 text-right" id="krw_sum_return_amt"></td>
            <td class="p-2 text-right" id="krw_sum_return_pct"></td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
  <!-- 보유 종목 상세 -->
  <div class="bg-white shadow rounded p-4 mb-6">
    <div class="text-sm font-medium mb-2">{{ _('stock_details_usd') }}</div>
    <div class="overflow-x-auto">
      <table class="table-auto w-full text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="p-2 text-left">{{ _('stock_name') }}</th>
            <th class="p-2 text-left">{{ _('stock_code') }}</th>
            <th class="p-2 text-left">{{ _('account_name') }}</th>
            <th class="p-2 text-right">{{ _('quantity') }}</th>
            <th class="p-2 text-right">{{ _('avg_price_usd') }}</th>
            <th class="p-2 text-right">{{ _('current_price_usd') }}</th>
            <th class="p-2 text-right">{{ _('total_value_usd') }}</th>
            <th class="p-2 text-right">{{ _('total_gain_usd') }}</th>
            <th class="p-2 text-right">{{ _('total_dividend_usd') }}</th>
            <th class="p-2 text-right">{{ _('return_rate') }}</th>
          </tr>
        </thead>
        <tbody id="stock_table_usd">
          <!-- JS에서 동적으로 채움 -->
        </tbody>
      </table>
    </div>
  </div>
  <div class="bg-white shadow rounded p-4 mb-6">
    <div class="text-sm font-medium mb-2">{{ _('stock_details_krw') }}</div>
    <div class="overflow-x-auto">
      <table class="table-auto w-full text-sm">
        <thead class="bg-gray-50">
          <tr>
            <th class="p-2 text-left">{{ _('stock_name') }}</th>
            <th class="p-2 text-left">{{ _('stock_code') }}</th>
            <th class="p-2 text-left">{{ _('account_name') }}</th>
            <th class="p-2 text-right">{{ _('quantity') }}</th>
            <th class="p-2 text-right">{{ _('avg_price_krw') }}</th>
            <th class="p-2 text-right">{{ _('current_price_krw') }}</th>
            <th class="p-2 text-right">{{ _('total_value_krw') }}</th>
            <th class="p-2 text-right">{{ _('total_gain_krw') }}</th>
            <th class="p-2 text-right">{{ _('total_dividend_krw') }}</th>
            <th class="p-2 text-right">{{ _('return_rate') }}</th>
          </tr>
        </thead>
        <tbody id="stock_table_krw">
          <!-- JS에서 동적으로 채움 -->
        </tbody>
      </table>
    </div>
  </div>
  <div class="bg-white shadow rounded p-4 mb-6">
    <div class="text-sm font-medium mb-2">{{ _('asset_category_breakdown') }}</div>
    <canvas id="categoryPie" class="max-w-[400px] max-h-[400px]"></canvas>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <script src="{{ url_for('static', path='js/dashboard/dashboard.js') }}"></script>
{% endblock %}
